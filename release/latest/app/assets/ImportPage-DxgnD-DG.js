import{A as X,P as H,W as S,a as P,d as k,f as Q,r as ce,j as o}from"./index-CF42LyZY.js";import{g as de,r as I}from"./vendor-B7kh90xw.js";import{r as le}from"./data-BuiUnMz4.js";import{r as ue}from"./anomalyHistory-LdOS7zhT.js";import{g as Z,t as C,c as R,m as pe,a as me,b as fe,d as he,s as Y,e as J,f as xe,h as we,i as ee,j as te,k as ye,l as V,n as ge,w as B,o as _e,p as be,q,r as L}from"./weekDates-DBDw0wls.js";import"./anomalyRules-sVyOhB1E.js";var ke=le();const re=de(ke),ve={date:"date",status:"status",person:"person",full_name:"full_name",client:"client",project:"project",activity:"activity",hours:"hours",billable:"billable",timesheet_entry_note:"timesheet_entry_note",task:"task",task_reference:"task_reference",folder:"folder",package:"package",person_id:"person_id",client_id:"client_id",project_id:"project_id",activity_id:"activity_id",task_id:"task_id",folder_id:"folder_id",package_id:"package_id",timesheet_entry_id:"timesheet_entry_id",person_reference:"person_reference",client_reference:"client_reference",project_reference:"project_reference",is_done:"is_done",done_date:"done_date",team:"team",month:"month",week:"week",tags:"tags",inherited_tags:"inherited_tags",max_effort:"max_effort","R #":"r_number","Work Order Group":"work_order_group","Project Stage/Type":"project_stage_type","Drawing Number & Rev":"drawing_number_rev","Work Order Status":"work_order_status","Part Code":"part_code","Test Day":"test_day","Source/ Facility":"source_facility","JN/ Order #":"jn_order","Job Type ":"job_type","Sourcing Category":"sourcing_category","PO#":"po_number",Supplier:"supplier","Due Date":"due_date","CPR#":"cpr_number",Region:"region","Major Market":"major_market","Department Code":"department_code","Approved Date":"approved_date",Approval:"approval",Cost:"cost","Project Phase":"project_phase",Order:"order","Dependency Satisfied Date":"dependency_satisfied_date",Market:"market","Task Approved Date":"task_approved_date",Rework:"rework","Original Deadline":"original_deadline","Test Type":"test_type",Andon:"andon","Number of Tests":"number_of_tests"};function je(s){const e=s.match(/^Victaulic\.timesheets\.(.+)\.(\d{4}-\d{2}-\d{2}) to (\d{4}-\d{2}-\d{2})\.csv$/);if(e)return{team:e[1],startDate:e[2],endDate:e[3]};const r=s.match(/^Victaulic_timesheets_(.+)_(\d{4}-\d{2}-\d{2})_to_(\d{4}-\d{2}-\d{2})\.csv$/);return r?{team:r[1],startDate:r[2],endDate:r[3]}:null}async function De(s){return new Promise(e=>{const r=[],t=[];re.parse(s,{header:!0,skipEmptyLines:!0,transformHeader:n=>n.replace(/^\uFEFF/,"").trim(),complete:n=>{for(let a=0;a<n.data.length;a++){const c=n.data[a];try{const d=Pe(c);t.push(d)}catch(d){r.push(`Row ${a+1}: ${d instanceof Error?d.message:String(d)}`)}}e({entries:t,errors:r})},error:n=>{r.push(`Parse error: ${n.message}`),e({entries:t,errors:r})}})})}function Pe(s){const e={};for(const[r,t]of Object.entries(ve)){const n=s[r];if(n==null){e[t]="";continue}const a=n.trim();switch(t){case"hours":e[t]=parseFloat(a)||0;break;case"person_id":case"project_id":case"activity_id":case"task_id":case"folder_id":case"timesheet_entry_id":e[t]=parseInt(a)||0;break;case"week":e[t]=parseInt(a)||0;break;case"is_done":e[t]=a.toLowerCase()==="true";break;case"activity":Object.values(X).includes(a),e[t]=a;break;default:e[t]=a}}if(!e.timesheet_entry_id)throw new Error("Missing timesheet_entry_id");if(!e.date)throw new Error("Missing date");return e.r_number||(e.r_number="UNKNOWN"),e}function Me(s){const e=[],r=[];for(let t=0;t<s.length;t++){const n=s[t];try{const a=Ne(n);e.push(a)}catch(a){r.push(`Entry ${t+1}: ${a instanceof Error?a.message:String(a)}`)}}return{entries:e,errors:r}}function Ne(s){if(!s.timesheet_entry_id)throw new Error("Missing timesheet_entry_id");if(!s.date)throw new Error("Missing date");if(!s.person_id)throw new Error("Missing person_id");return{timesheet_entry_id:s.timesheet_entry_id,date:s.date,status:s.status||"",person:s.person||"",full_name:s.full_name||"",client:s.client||"",project:s.project||"",activity:s.activity,hours:s.hours||0,billable:s.billable||"",timesheet_entry_note:s.timesheet_entry_note||"",task:s.task||"",task_reference:s.task_reference||"",folder:s.folder||"",package:s.package||"",person_id:s.person_id,client_id:s.client_id||"",project_id:s.project_id||0,activity_id:s.activity_id||0,task_id:s.task_id||0,folder_id:s.folder_id||0,package_id:s.package_id||"",person_reference:s.person_reference||"",client_reference:s.client_reference||"",project_reference:s.project_reference||"",is_done:s.is_done||!1,done_date:s.done_date||"",team:s.team||"",month:s.month||"",week:s.week||0,tags:s.tags||"",inherited_tags:s.inherited_tags||"",max_effort:s.max_effort||"",r_number:s.r_number||"UNKNOWN",work_order_group:s.work_order_group||"",project_stage_type:s.project_stage_type||"",drawing_number_rev:s.drawing_number_rev||"",work_order_status:s.work_order_status||"",part_code:s.part_code||"",test_day:s.test_day||"",source_facility:s.source_facility||"",jn_order:s.jn_order||"",job_type:s.job_type||"",sourcing_category:s.sourcing_category||"",po_number:s.po_number||"",supplier:s.supplier||"",due_date:s.due_date||"",cpr_number:s.cpr_number||"",region:s.region||"",major_market:s.major_market||"",department_code:s.department_code||"",approved_date:s.approved_date||"",approval:s.approval||"",cost:s.cost||"",project_phase:s.project_phase||"",order:s.order||"",dependency_satisfied_date:s.dependency_satisfied_date||"",market:s.market||"",task_approved_date:s.task_approved_date||"",rework:s.rework||"",original_deadline:s.original_deadline||"",test_type:s.test_type||"",andon:s.andon||"",number_of_tests:s.number_of_tests||""}}const z={"R1337.1":"K4.0 Resi Concealed Sidewall","R1337.2":"K8.0 Resi Concealed Sidewall ECLH","R1337.3":"K5.6 Resi Concealed Sidewall","R1430.1A":"K11.2 Low Profile In Rack Storage Sprinkler","R1430.1B":"K8.0 Low Profile In Rack Storage Sprinkler","R1430.1C":"K5.6 Low Profile In Rack Storage Sprinkler","R1514.1":"K4.9 Resi Concealed Pendent","R1514.2":"K3.0 Resi Concealed Pendent",R1517:"K22/K25 ESFR High Pressure","R1517.1":"K17 ESFR High Pressure",R1518:"Universal Cleanroom",R1527:"UL Listing for Vortex",S0001:"V10 Spray Nozzle Kfactor Noncompliance",S0057:"VicFlex Double Window VB5 Data Center Bracket",S0013:"General Sustaining Support",S0062:"VTI 300 Bar Cylinder Valve",R0999:"Out of Office (PTO/Holiday)",R0996:"Administrative Work",S0004:"Regulatory Support / Industry Committee Work",R0992:"Applications / Sales Support",S0002:"EP Support",S0005:"Manufacturing Support",R0991:"Lab 5S Support",S0006:"Submittal Modifications",S0082:"Vortex Sustaining",R0751:"QA / PER Support",S0008:"Drawing Maintenance",S0003:"Reliability Growth"},Te=new Set(["R0992","S0002","S0005","R0991","R0751","S0008","S0003","S0001","R0993"]);function Ee(s,e){if(s==="R0996")return P.Admin;if(s==="R0999")return P.OutOfOffice;if(s.startsWith("T"))return P.Sprint;const r=e.split(",").map(n=>n.trim().toLowerCase());if(r.includes("npd"))return P.NPD;if(r.includes("sustaineng"))return P.Sustaining;if(s.startsWith("S"))return P.Sustaining;const t=s.match(/^R(\d+)/);if(t){const n=parseInt(t[1]);return n>999&&n!==996&&n!==999?P.NPD:P.Sustaining}return P.Sustaining}function Re(s){return Te.has(s)?S.UnplannedFirefighting:S.Planned}function G(s){const e=s.reduce((t,n)=>t+n.hours,0),r=s.filter(t=>t.activity===X.LabTesting).reduce((t,n)=>t+n.hours,0);return e>0&&r/e>.6?H.LabTechnician:H.Engineer}function Ie(s,e){if(z[s])return z[s];const r=e.filter(a=>a.r_number===s),t=new Map;for(const a of r)t.set(a.project,(t.get(a.project)||0)+1);return[...t.entries()].sort((a,c)=>c[1]!==a[1]?c[1]-a[1]:a[0].length-c[0].length)[0]?.[0]||s}async function Ce(s){const e=s.map(a=>a.timesheet_entry_id),r=await k.timesheets.bulkGet(e),t=new Set(r.filter(Boolean).map(a=>a.timesheet_entry_id)),n=s.filter(a=>!t.has(a.timesheet_entry_id));return{newEntries:n,duplicateCount:s.length-n.length}}async function Le(s){const e=[],r=await k.teamMembers.toArray(),t=new Set(r.map(a=>a.person_id)),n=new Map;for(const a of s)n.has(a.person_id)||n.set(a.person_id,[]),n.get(a.person_id).push(a);for(const[a,c]of n)if(t.has(a)){const p=[...await k.timesheets.where("person_id").equals(a).toArray(),...c],l=G(p);await k.teamMembers.update(a,{role:l})}else{const p=[...await k.timesheets.where("person_id").equals(a).toArray(),...c],l=G(p),u={person_id:a,person:c[0].person,full_name:c[0].full_name,role:l,capacity_override_hours:0};await k.teamMembers.add(u),e.push(u.full_name)}return e}async function Oe(s){const e=[],r=await k.projects.toArray(),t=new Set(r.map(a=>a.project_id)),n=new Map;for(const a of s)a.r_number&&(n.has(a.r_number)||n.set(a.r_number,[]),n.get(a.r_number).push(a));for(const[a,c]of n)if(!t.has(a)){const p=[...await k.timesheets.where("r_number").equals(a).toArray(),...c],l={project_id:a,project_name:Ie(a,p),type:Ee(a,c[0].inherited_tags),work_class:Re(a)};await k.projects.add(l),e.push(a)}return e}async function He(s){await k.timesheets.bulkAdd(s)}async function Fe(s){await k.importLogs.add(s)}async function Ye(){return(await k.importLogs.orderBy("imported_at").reverse().limit(1).toArray())[0]}async function qe(){const s=await Ye(),e=await k.timesheets.toArray(),r=await k.teamMembers.toArray();let t=null,n=null,a=[];if(e.length>0){const u=e.map(x=>x.date).sort();t=u[0],n=u[u.length-1];const w=new Set(e.map(x=>x.month));a=Ae(w)}const c=e.reduce((u,w)=>u+w.hours,0),d=r.filter(u=>u.role===H.Engineer).length,p=r.filter(u=>u.role===H.LabTechnician).length,l=r.length-d-p;return{lastImportDate:s?.imported_at||null,dateRangeStart:t,dateRangeEnd:n,totalEntries:e.length,totalHours:c,peopleCount:r.length,engineerCount:d,techCount:p,unclassifiedCount:l,missingDateGaps:a}}function Ae(s){if(s.size<2)return[];const e=[...s].map(t=>{const[n,a]=t.split("/").map(Number);return{year:n,month:a,key:t}}).sort((t,n)=>t.year-n.year||t.month-n.month),r=[];for(let t=0;t<e.length-1;t++){const n=e[t],a=e[t+1];let c=n.year,d=n.month+1;d>12&&(d=1,c++);let p=null,l=null;for(;c<a.year||c===a.year&&d<a.month;){const u=`${c}/${String(d).padStart(2,"0")}`;p||(p=u),l=u,d++,d>12&&(d=1,c++)}p&&l&&r.push({from:p,to:l})}return r}async function We(s,e,r){const t=await k.config.get(1);if(t){const n={};!t.team_name&&s&&(n.team_name=s),!t.selected_month&&e&&(n.selected_month=e),!t.selected_project&&r&&(n.selected_project=r),Object.keys(n).length>0&&await k.config.update(1,n)}}function $e(){return Object.assign({},Z())}function Se(s,e){const r=C(s,e?.in).getDay();return r===0?7:r}function Qe(s,e){const r=Ve(e)?new e(0):R(e,0);return r.setFullYear(s.getFullYear(),s.getMonth(),s.getDate()),r.setHours(s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()),r}function Ve(s){return typeof s=="function"&&s.prototype?.constructor===s}const Be=10;class se{subPriority=0;validate(e,r){return!0}}class ze extends se{constructor(e,r,t,n,a){super(),this.value=e,this.validateValue=r,this.setValue=t,this.priority=n,a&&(this.subPriority=a)}validate(e,r){return this.validateValue(e,this.value,r)}set(e,r,t){return this.setValue(e,r,this.value,t)}}class Ge extends se{priority=Be;subPriority=-1;constructor(e,r){super(),this.context=e||(t=>R(r,t))}set(e,r){return r.timestampIsSet?e:R(e,Qe(e,this.context))}}class h{run(e,r,t,n){const a=this.parse(e,r,t,n);return a?{setter:new ze(a.value,this.validate,this.set,this.priority,this.subPriority),rest:a.rest}:null}validate(e,r,t){return!0}}class Ke extends h{priority=140;parse(e,r,t){switch(r){case"G":case"GG":case"GGG":return t.era(e,{width:"abbreviated"})||t.era(e,{width:"narrow"});case"GGGGG":return t.era(e,{width:"narrow"});default:return t.era(e,{width:"wide"})||t.era(e,{width:"abbreviated"})||t.era(e,{width:"narrow"})}}set(e,r,t){return r.era=t,e.setFullYear(t,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["R","u","t","T"]}const _={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},M={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function b(s,e){return s&&{value:e(s.value),rest:s.rest}}function y(s,e){const r=e.match(s);return r?{value:parseInt(r[0],10),rest:e.slice(r[0].length)}:null}function N(s,e){const r=e.match(s);if(!r)return null;if(r[0]==="Z")return{value:0,rest:e.slice(1)};const t=r[1]==="+"?1:-1,n=r[2]?parseInt(r[2],10):0,a=r[3]?parseInt(r[3],10):0,c=r[5]?parseInt(r[5],10):0;return{value:t*(n*pe+a*me+c*fe),rest:e.slice(r[0].length)}}function ne(s){return y(_.anyDigitsSigned,s)}function g(s,e){switch(s){case 1:return y(_.singleDigit,e);case 2:return y(_.twoDigits,e);case 3:return y(_.threeDigits,e);case 4:return y(_.fourDigits,e);default:return y(new RegExp("^\\d{1,"+s+"}"),e)}}function F(s,e){switch(s){case 1:return y(_.singleDigitSigned,e);case 2:return y(_.twoDigitsSigned,e);case 3:return y(_.threeDigitsSigned,e);case 4:return y(_.fourDigitsSigned,e);default:return y(new RegExp("^-?\\d{1,"+s+"}"),e)}}function A(s){switch(s){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;default:return 0}}function ae(s,e){const r=e>0,t=r?e:1-e;let n;if(t<=50)n=s||100;else{const a=t+50,c=Math.trunc(a/100)*100,d=s>=a%100;n=s+c-(d?100:0)}return r?n:1-n}function oe(s){return s%400===0||s%4===0&&s%100!==0}class Ue extends h{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(e,r,t){const n=a=>({year:a,isTwoDigitYear:r==="yy"});switch(r){case"y":return b(g(4,e),n);case"yo":return b(t.ordinalNumber(e,{unit:"year"}),n);default:return b(g(r.length,e),n)}}validate(e,r){return r.isTwoDigitYear||r.year>0}set(e,r,t){const n=e.getFullYear();if(t.isTwoDigitYear){const c=ae(t.year,n);return e.setFullYear(c,0,1),e.setHours(0,0,0,0),e}const a=!("era"in r)||r.era===1?t.year:1-t.year;return e.setFullYear(a,0,1),e.setHours(0,0,0,0),e}}class Xe extends h{priority=130;parse(e,r,t){const n=a=>({year:a,isTwoDigitYear:r==="YY"});switch(r){case"Y":return b(g(4,e),n);case"Yo":return b(t.ordinalNumber(e,{unit:"year"}),n);default:return b(g(r.length,e),n)}}validate(e,r){return r.isTwoDigitYear||r.year>0}set(e,r,t,n){const a=he(e,n);if(t.isTwoDigitYear){const d=ae(t.year,a);return e.setFullYear(d,0,n.firstWeekContainsDate),e.setHours(0,0,0,0),Y(e,n)}const c=!("era"in r)||r.era===1?t.year:1-t.year;return e.setFullYear(c,0,n.firstWeekContainsDate),e.setHours(0,0,0,0),Y(e,n)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class Ze extends h{priority=130;parse(e,r){return F(r==="R"?4:r.length,e)}set(e,r,t){const n=R(e,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),J(n)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class Je extends h{priority=130;parse(e,r){return F(r==="u"?4:r.length,e)}set(e,r,t){return e.setFullYear(t,0,1),e.setHours(0,0,0,0),e}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class et extends h{priority=120;parse(e,r,t){switch(r){case"Q":case"QQ":return g(r.length,e);case"Qo":return t.ordinalNumber(e,{unit:"quarter"});case"QQQ":return t.quarter(e,{width:"abbreviated",context:"formatting"})||t.quarter(e,{width:"narrow",context:"formatting"});case"QQQQQ":return t.quarter(e,{width:"narrow",context:"formatting"});default:return t.quarter(e,{width:"wide",context:"formatting"})||t.quarter(e,{width:"abbreviated",context:"formatting"})||t.quarter(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=1&&r<=4}set(e,r,t){return e.setMonth((t-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class tt extends h{priority=120;parse(e,r,t){switch(r){case"q":case"qq":return g(r.length,e);case"qo":return t.ordinalNumber(e,{unit:"quarter"});case"qqq":return t.quarter(e,{width:"abbreviated",context:"standalone"})||t.quarter(e,{width:"narrow",context:"standalone"});case"qqqqq":return t.quarter(e,{width:"narrow",context:"standalone"});default:return t.quarter(e,{width:"wide",context:"standalone"})||t.quarter(e,{width:"abbreviated",context:"standalone"})||t.quarter(e,{width:"narrow",context:"standalone"})}}validate(e,r){return r>=1&&r<=4}set(e,r,t){return e.setMonth((t-1)*3,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class rt extends h{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(e,r,t){const n=a=>a-1;switch(r){case"M":return b(y(_.month,e),n);case"MM":return b(g(2,e),n);case"Mo":return b(t.ordinalNumber(e,{unit:"month"}),n);case"MMM":return t.month(e,{width:"abbreviated",context:"formatting"})||t.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return t.month(e,{width:"narrow",context:"formatting"});default:return t.month(e,{width:"wide",context:"formatting"})||t.month(e,{width:"abbreviated",context:"formatting"})||t.month(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=0&&r<=11}set(e,r,t){return e.setMonth(t,1),e.setHours(0,0,0,0),e}}class st extends h{priority=110;parse(e,r,t){const n=a=>a-1;switch(r){case"L":return b(y(_.month,e),n);case"LL":return b(g(2,e),n);case"Lo":return b(t.ordinalNumber(e,{unit:"month"}),n);case"LLL":return t.month(e,{width:"abbreviated",context:"standalone"})||t.month(e,{width:"narrow",context:"standalone"});case"LLLLL":return t.month(e,{width:"narrow",context:"standalone"});default:return t.month(e,{width:"wide",context:"standalone"})||t.month(e,{width:"abbreviated",context:"standalone"})||t.month(e,{width:"narrow",context:"standalone"})}}validate(e,r){return r>=0&&r<=11}set(e,r,t){return e.setMonth(t,1),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function nt(s,e,r){const t=C(s,r?.in),n=xe(t,r)-e;return t.setDate(t.getDate()-n*7),C(t,r?.in)}class at extends h{priority=100;parse(e,r,t){switch(r){case"w":return y(_.week,e);case"wo":return t.ordinalNumber(e,{unit:"week"});default:return g(r.length,e)}}validate(e,r){return r>=1&&r<=53}set(e,r,t,n){return Y(nt(e,t,n),n)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function ot(s,e,r){const t=C(s,r?.in),n=we(t,r)-e;return t.setDate(t.getDate()-n*7),t}class it extends h{priority=100;parse(e,r,t){switch(r){case"I":return y(_.week,e);case"Io":return t.ordinalNumber(e,{unit:"week"});default:return g(r.length,e)}}validate(e,r){return r>=1&&r<=53}set(e,r,t){return J(ot(e,t))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const ct=[31,28,31,30,31,30,31,31,30,31,30,31],dt=[31,29,31,30,31,30,31,31,30,31,30,31];class lt extends h{priority=90;subPriority=1;parse(e,r,t){switch(r){case"d":return y(_.date,e);case"do":return t.ordinalNumber(e,{unit:"date"});default:return g(r.length,e)}}validate(e,r){const t=e.getFullYear(),n=oe(t),a=e.getMonth();return n?r>=1&&r<=dt[a]:r>=1&&r<=ct[a]}set(e,r,t){return e.setDate(t),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class ut extends h{priority=90;subpriority=1;parse(e,r,t){switch(r){case"D":case"DD":return y(_.dayOfYear,e);case"Do":return t.ordinalNumber(e,{unit:"date"});default:return g(r.length,e)}}validate(e,r){const t=e.getFullYear();return oe(t)?r>=1&&r<=366:r>=1&&r<=365}set(e,r,t){return e.setMonth(0,t),e.setHours(0,0,0,0),e}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function W(s,e,r){const t=Z(),n=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??t.weekStartsOn??t.locale?.options?.weekStartsOn??0,a=C(s,r?.in),c=a.getDay(),p=(e%7+7)%7,l=7-n,u=e<0||e>6?e-(c+l)%7:(p+l)%7-(c+l)%7;return ee(a,u,r)}class pt extends h{priority=90;parse(e,r,t){switch(r){case"E":case"EE":case"EEE":return t.day(e,{width:"abbreviated",context:"formatting"})||t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"});case"EEEEE":return t.day(e,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"});default:return t.day(e,{width:"wide",context:"formatting"})||t.day(e,{width:"abbreviated",context:"formatting"})||t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=0&&r<=6}set(e,r,t,n){return e=W(e,t,n),e.setHours(0,0,0,0),e}incompatibleTokens=["D","i","e","c","t","T"]}class mt extends h{priority=90;parse(e,r,t,n){const a=c=>{const d=Math.floor((c-1)/7)*7;return(c+n.weekStartsOn+6)%7+d};switch(r){case"e":case"ee":return b(g(r.length,e),a);case"eo":return b(t.ordinalNumber(e,{unit:"day"}),a);case"eee":return t.day(e,{width:"abbreviated",context:"formatting"})||t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"});case"eeeee":return t.day(e,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"});default:return t.day(e,{width:"wide",context:"formatting"})||t.day(e,{width:"abbreviated",context:"formatting"})||t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"})}}validate(e,r){return r>=0&&r<=6}set(e,r,t,n){return e=W(e,t,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class ft extends h{priority=90;parse(e,r,t,n){const a=c=>{const d=Math.floor((c-1)/7)*7;return(c+n.weekStartsOn+6)%7+d};switch(r){case"c":case"cc":return b(g(r.length,e),a);case"co":return b(t.ordinalNumber(e,{unit:"day"}),a);case"ccc":return t.day(e,{width:"abbreviated",context:"standalone"})||t.day(e,{width:"short",context:"standalone"})||t.day(e,{width:"narrow",context:"standalone"});case"ccccc":return t.day(e,{width:"narrow",context:"standalone"});case"cccccc":return t.day(e,{width:"short",context:"standalone"})||t.day(e,{width:"narrow",context:"standalone"});default:return t.day(e,{width:"wide",context:"standalone"})||t.day(e,{width:"abbreviated",context:"standalone"})||t.day(e,{width:"short",context:"standalone"})||t.day(e,{width:"narrow",context:"standalone"})}}validate(e,r){return r>=0&&r<=6}set(e,r,t,n){return e=W(e,t,n),e.setHours(0,0,0,0),e}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function ht(s,e,r){const t=C(s,r?.in),n=Se(t,r),a=e-n;return ee(t,a,r)}class xt extends h{priority=90;parse(e,r,t){const n=a=>a===0?7:a;switch(r){case"i":case"ii":return g(r.length,e);case"io":return t.ordinalNumber(e,{unit:"day"});case"iii":return b(t.day(e,{width:"abbreviated",context:"formatting"})||t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"}),n);case"iiiii":return b(t.day(e,{width:"narrow",context:"formatting"}),n);case"iiiiii":return b(t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"}),n);default:return b(t.day(e,{width:"wide",context:"formatting"})||t.day(e,{width:"abbreviated",context:"formatting"})||t.day(e,{width:"short",context:"formatting"})||t.day(e,{width:"narrow",context:"formatting"}),n)}}validate(e,r){return r>=1&&r<=7}set(e,r,t){return e=ht(e,t),e.setHours(0,0,0,0),e}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class wt extends h{priority=80;parse(e,r,t){switch(r){case"a":case"aa":case"aaa":return t.dayPeriod(e,{width:"abbreviated",context:"formatting"})||t.dayPeriod(e,{width:"narrow",context:"formatting"});case"aaaaa":return t.dayPeriod(e,{width:"narrow",context:"formatting"});default:return t.dayPeriod(e,{width:"wide",context:"formatting"})||t.dayPeriod(e,{width:"abbreviated",context:"formatting"})||t.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,r,t){return e.setHours(A(t),0,0,0),e}incompatibleTokens=["b","B","H","k","t","T"]}class yt extends h{priority=80;parse(e,r,t){switch(r){case"b":case"bb":case"bbb":return t.dayPeriod(e,{width:"abbreviated",context:"formatting"})||t.dayPeriod(e,{width:"narrow",context:"formatting"});case"bbbbb":return t.dayPeriod(e,{width:"narrow",context:"formatting"});default:return t.dayPeriod(e,{width:"wide",context:"formatting"})||t.dayPeriod(e,{width:"abbreviated",context:"formatting"})||t.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,r,t){return e.setHours(A(t),0,0,0),e}incompatibleTokens=["a","B","H","k","t","T"]}class gt extends h{priority=80;parse(e,r,t){switch(r){case"B":case"BB":case"BBB":return t.dayPeriod(e,{width:"abbreviated",context:"formatting"})||t.dayPeriod(e,{width:"narrow",context:"formatting"});case"BBBBB":return t.dayPeriod(e,{width:"narrow",context:"formatting"});default:return t.dayPeriod(e,{width:"wide",context:"formatting"})||t.dayPeriod(e,{width:"abbreviated",context:"formatting"})||t.dayPeriod(e,{width:"narrow",context:"formatting"})}}set(e,r,t){return e.setHours(A(t),0,0,0),e}incompatibleTokens=["a","b","t","T"]}class _t extends h{priority=70;parse(e,r,t){switch(r){case"h":return y(_.hour12h,e);case"ho":return t.ordinalNumber(e,{unit:"hour"});default:return g(r.length,e)}}validate(e,r){return r>=1&&r<=12}set(e,r,t){const n=e.getHours()>=12;return n&&t<12?e.setHours(t+12,0,0,0):!n&&t===12?e.setHours(0,0,0,0):e.setHours(t,0,0,0),e}incompatibleTokens=["H","K","k","t","T"]}class bt extends h{priority=70;parse(e,r,t){switch(r){case"H":return y(_.hour23h,e);case"Ho":return t.ordinalNumber(e,{unit:"hour"});default:return g(r.length,e)}}validate(e,r){return r>=0&&r<=23}set(e,r,t){return e.setHours(t,0,0,0),e}incompatibleTokens=["a","b","h","K","k","t","T"]}class kt extends h{priority=70;parse(e,r,t){switch(r){case"K":return y(_.hour11h,e);case"Ko":return t.ordinalNumber(e,{unit:"hour"});default:return g(r.length,e)}}validate(e,r){return r>=0&&r<=11}set(e,r,t){return e.getHours()>=12&&t<12?e.setHours(t+12,0,0,0):e.setHours(t,0,0,0),e}incompatibleTokens=["h","H","k","t","T"]}class vt extends h{priority=70;parse(e,r,t){switch(r){case"k":return y(_.hour24h,e);case"ko":return t.ordinalNumber(e,{unit:"hour"});default:return g(r.length,e)}}validate(e,r){return r>=1&&r<=24}set(e,r,t){const n=t<=24?t%24:t;return e.setHours(n,0,0,0),e}incompatibleTokens=["a","b","h","H","K","t","T"]}class jt extends h{priority=60;parse(e,r,t){switch(r){case"m":return y(_.minute,e);case"mo":return t.ordinalNumber(e,{unit:"minute"});default:return g(r.length,e)}}validate(e,r){return r>=0&&r<=59}set(e,r,t){return e.setMinutes(t,0,0),e}incompatibleTokens=["t","T"]}class Dt extends h{priority=50;parse(e,r,t){switch(r){case"s":return y(_.second,e);case"so":return t.ordinalNumber(e,{unit:"second"});default:return g(r.length,e)}}validate(e,r){return r>=0&&r<=59}set(e,r,t){return e.setSeconds(t,0),e}incompatibleTokens=["t","T"]}class Pt extends h{priority=30;parse(e,r){const t=n=>Math.trunc(n*Math.pow(10,-r.length+3));return b(g(r.length,e),t)}set(e,r,t){return e.setMilliseconds(t),e}incompatibleTokens=["t","T"]}class Mt extends h{priority=10;parse(e,r){switch(r){case"X":return N(M.basicOptionalMinutes,e);case"XX":return N(M.basic,e);case"XXXX":return N(M.basicOptionalSeconds,e);case"XXXXX":return N(M.extendedOptionalSeconds,e);default:return N(M.extended,e)}}set(e,r,t){return r.timestampIsSet?e:R(e,e.getTime()-te(e)-t)}incompatibleTokens=["t","T","x"]}class Nt extends h{priority=10;parse(e,r){switch(r){case"x":return N(M.basicOptionalMinutes,e);case"xx":return N(M.basic,e);case"xxxx":return N(M.basicOptionalSeconds,e);case"xxxxx":return N(M.extendedOptionalSeconds,e);default:return N(M.extended,e)}}set(e,r,t){return r.timestampIsSet?e:R(e,e.getTime()-te(e)-t)}incompatibleTokens=["t","T","X"]}class Tt extends h{priority=40;parse(e){return ne(e)}set(e,r,t){return[R(e,t*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class Et extends h{priority=20;parse(e){return ne(e)}set(e,r,t){return[R(e,t),{timestampIsSet:!0}]}incompatibleTokens="*"}const Rt={G:new Ke,y:new Ue,Y:new Xe,R:new Ze,u:new Je,Q:new et,q:new tt,M:new rt,L:new st,w:new at,I:new it,d:new lt,D:new ut,E:new pt,e:new mt,c:new ft,i:new xt,a:new wt,b:new yt,B:new gt,h:new _t,H:new bt,K:new kt,k:new vt,m:new jt,s:new Dt,S:new Pt,X:new Mt,x:new Nt,t:new Tt,T:new Et},It=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ct=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Lt=/^'([^]*?)'?$/,Ot=/''/g,Ht=/\S/,Ft=/[a-zA-Z]/;function ie(s,e,r,t){const n=()=>R(r,NaN),a=$e(),c=a.locale??ye,d=a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,p=a.weekStartsOn??a.locale?.options?.weekStartsOn??0;if(!e)return s?n():C(r,t?.in);const l={firstWeekContainsDate:d,weekStartsOn:p,locale:c},u=[new Ge(t?.in,r)],w=e.match(Ct).map(i=>{const m=i[0];if(m in V){const f=V[m];return f(i,c.formatLong)}return i}).join("").match(It),x=[];for(let i of w){ge(i)&&B(i,e,s),_e(i)&&B(i,e,s);const m=i[0],f=Rt[m];if(f){const{incompatibleTokens:D}=f;if(Array.isArray(D)){const O=x.find($=>D.includes($.token)||$.token===m);if(O)throw new RangeError(`The format string mustn't contain \`${O.fullToken}\` and \`${i}\` at the same time`)}else if(f.incompatibleTokens==="*"&&x.length>0)throw new RangeError(`The format string mustn't contain \`${i}\` and any other token at the same time`);x.push({token:m,fullToken:i});const E=f.run(s,i,c.match,l);if(!E)return n();u.push(E.setter),s=E.rest}else{if(m.match(Ft))throw new RangeError("Format string contains an unescaped latin alphabet character `"+m+"`");if(i==="''"?i="'":m==="'"&&(i=Yt(i)),s.indexOf(i)===0)s=s.slice(i.length);else return n()}}if(s.length>0&&Ht.test(s))return n();const v=u.map(i=>i.priority).sort((i,m)=>m-i).filter((i,m,f)=>f.indexOf(i)===m).map(i=>u.filter(m=>m.priority===i).sort((m,f)=>f.subPriority-m.subPriority)).map(i=>i[0]);let j=C(r,t?.in);if(isNaN(+j))return n();const T={};for(const i of v){if(!i.validate(j,l))return n();const m=i.set(j,T,l);Array.isArray(m)?(j=m[0],Object.assign(T,m[1])):j=m}return j}function Yt(s){return s.match(Lt)[1].replace(Ot,"'")}const qt={respondent_name:["your name"],project:["project"],week_ending:["week ending (friday)","week ending"],status:["project status","status"],completed_summary:["what did you accomplish this week?","accomplished","completed"],action_items_raw:["action items"],next_milestones:["next milestones","milestones"],notes:["additional notes","notes"]};function K(s,e){const r=s.map(t=>t.toLowerCase().trim());for(const t of e){const n=r.indexOf(t.toLowerCase());if(n!==-1)return n}for(const t of e){const n=r.findIndex(a=>a.includes(t.toLowerCase()));if(n!==-1)return n}return-1}function At(s){const e=s.trim(),r=["M/d/yyyy","MM/dd/yyyy","yyyy-MM-dd","d/M/yyyy","dd/MM/yyyy"];for(const n of r){const a=ie(e,n,new Date);if(q(a))return L(a,"yyyy-MM-dd")}const t=new Date(e);if(q(t))return L(t,"yyyy-MM-dd");throw new Error(`Cannot parse date: ${s}`)}function Wt(s){const e=s.match(/^([RST]\d+(?:\.\d+[A-Z]?)?)/);return e?e[1]:s.trim()}function $t(s){const e=s.trim().toLowerCase();return e.includes("on track")?"on-track":e.includes("at risk")?"at-risk":e.includes("blocked")?"blocked":e.includes("complete")?"complete":"on-track"}function St(s){if(!s||!s.trim())return[];const e=[],r=s.split(/\n/).map(t=>t.trim()).filter(Boolean);for(let t of r){if(t=t.replace(/^\d+[.)]\s*/,"").replace(/^[-•·]\s*/,"").trim(),!t)continue;let n="",a="";const c=t.match(/\s+-\s+([A-Z][a-z]+(?:\s[A-Z][a-z]+)?)\s*$/);if(c)n=c[1],t=t.replace(c[0],"").trim();else{const p=t.match(/\(([A-Z][a-z]+(?:\s[A-Z][a-z]+)?)\)\s*$/);p&&(n=p[1],t=t.replace(p[0],"").trim())}const d=t.match(/\b(?:by|due)\s+(\d{1,2}\/\d{1,2}(?:\/\d{2,4})?)/i);if(d){const p=d[1];try{const l=p.split("/"),u=l.length===2?`${p}/${new Date().getFullYear()}`:p,w=ie(u,(l.length===2,"M/d/yyyy"),new Date);q(w)&&(a=L(w,"yyyy-MM-dd"))}catch{}}e.push({id:crypto.randomUUID(),text:t.replace(/\s+/g," ").trim(),owner:n,due_date:a,done:!1})}return e}function Qt(s){const e=s.map(c=>c.toLowerCase().trim()),t=["date","person","activity","hours"].every(c=>e.some(d=>d.includes(c)))&&e.some(c=>c.includes("r #")||c.includes("r_number")),a=["id","start time","completion time","email"].every(c=>e.some(d=>d.includes(c)));return t?"timesheet":a?"feedback":"unknown"}function Vt(s,e){const r=[],t=re.parse(s,{header:!0,skipEmptyLines:!0,transformHeader:u=>u.trim()});if(!t.data||t.data.length===0)return{feedbacks:[],warnings:["No data rows found in CSV"]};const n=t.meta.fields??[],a={};for(const[u,w]of Object.entries(qt)){const x=K(n,w);x===-1&&r.push(`Column not found for "${u}" — will use empty values`),a[u]=x}const c=K(n,["completion time"]),d=[];for(let u=0;u<t.data.length;u++){const w=t.data[u],x=n.map(f=>w[f]??""),v=f=>{const D=a[f];return D>=0?(x[D]??"").trim():""},j=v("project");if(!j){r.push(`Row ${u+2}: Missing project — skipped`);continue}const T=v("week_ending");if(!T){r.push(`Row ${u+2}: Missing week ending date — skipped`);continue}let i;try{const f=At(T);i=be(f),f!==i&&r.push(`Row ${u+2}: Date ${T} snapped to Friday ${i}`)}catch{r.push(`Row ${u+2}: Invalid date "${T}" — skipped`);continue}const m=c>=0?x[c]??"":"";d.push({project_id:Wt(j),week_ending:i,status:$t(v("status")),completed_summary:v("completed_summary"),action_items:St(v("action_items_raw")),next_milestones:v("next_milestones"),notes:v("notes"),updated_by:v("respondent_name"),submitted_at:m?new Date(m).toISOString():new Date().toISOString(),completion_time:m})}const p=new Map;for(const u of d){const w=`${u.project_id}::${u.week_ending}`,x=p.get(w);(!x||u.completion_time>x.completion_time)&&p.set(w,u)}return p.size<d.length&&r.push(`${d.length-p.size} duplicate submission(s) resolved (kept latest)`),{feedbacks:[...p.values()].map(({completion_time:u,...w})=>w),warnings:r}}async function U(s){const e={success:!1,filename:s.name,team:"",dateRangeStart:"",dateRangeEnd:"",totalRowsParsed:0,newRowsInserted:0,duplicateRowsSkipped:0,newPeopleDiscovered:[],newProjectsDiscovered:[],totalHoursImported:0,errors:[]};try{const r=je(s.name);r?(e.team=r.team,e.dateRangeStart=r.startDate,e.dateRangeEnd=r.endDate):e.errors.push("Filename does not match expected pattern: Victaulic.timesheets.{TEAM}.{START} to {END}.csv");const{entries:t,errors:n}=await De(s);if(e.errors.push(...n),e.totalRowsParsed=t.length,t.length===0)return e.errors.push("No data rows found in CSV"),e;const{entries:a,errors:c}=Me(t);if(e.errors.push(...c),a.length===0)return e.errors.push("No valid entries after normalization"),e;const{newEntries:d,duplicateCount:p}=await Ce(a);if(e.duplicateRowsSkipped=p,e.newRowsInserted=d.length,d.length===0)return e.success=!0,e.errors.push("All entries already exist in database (0 new entries)"),e;await He(d);const l=await Le(d);e.newPeopleDiscovered=l;const u=await Oe(d);if(e.newProjectsDiscovered=u,e.totalHoursImported=d.reduce((x,v)=>x+v.hours,0),e.team){const x=await k.projects.where("type").equals(P.NPD).toArray(),v=x.length>0?x[0].project_id:"",j=d[0]?Q(d[0].month):"";await We(e.team,j,v)}await Fe({filename:s.name,imported_at:new Date().toISOString(),team:e.team,date_range_start:e.dateRangeStart,date_range_end:e.dateRangeEnd,total_rows:e.totalRowsParsed,new_rows:e.newRowsInserted,duplicate_rows:e.duplicateRowsSkipped,people_count:e.newPeopleDiscovered.length,total_hours:e.totalHoursImported}),await ce();const w=[...new Set(d.map(x=>Q(x.month)))];for(const x of w)await ue(x);e.success=!0}catch(r){e.errors.push(`Import failed: ${r instanceof Error?r.message:String(r)}`),e.success=!1}return e}async function Bt(s){const e={success:!1,filename:s.name,type:"feedback",imported:0,updated:0,projects:[],weekEnding:"",errors:[],warnings:[]};try{const r=await s.text(),{feedbacks:t,warnings:n}=Vt(r,s.name);if(e.warnings=n,t.length===0)return e.errors.push("No valid feedback entries found in CSV"),e;const a=new Set,c=new Set;for(const d of t)try{a.add(d.project_id),c.add(d.week_ending);const p=await k.weeklyUpdates.where("[project_id+week_ending]").equals([d.project_id,d.week_ending]).first(),l={project_id:d.project_id,week_ending:d.week_ending,status:d.status,completed_summary:d.completed_summary,action_items:d.action_items,next_milestones:d.next_milestones,notes:d.notes,updated_at:d.submitted_at,updated_by:d.updated_by};p?(await k.weeklyUpdates.update(p.id,l),e.updated++):(await k.weeklyUpdates.add(l),e.imported++)}catch(p){e.errors.push(`Failed to import ${d.project_id} week ${d.week_ending}: ${p}`)}e.projects=[...a].sort(),e.weekEnding=[...c].sort().reverse()[0]??"",e.success=e.errors.length===0}catch(r){e.errors.push(`Import failed: ${r instanceof Error?r.message:String(r)}`)}return e}async function zt(s){const t=((await s.text()).split(`
`)[0]??"").split(",").map(n=>n.replace(/"/g,"").trim());return Qt(t)}async function Gt(s,e){const r=[];for(let t=0;t<s.length;t++){const n=s[t];e&&e(t+1,s.length,n.name);const a=await zt(n);if(a==="feedback"){const c=await Bt(n);r.push(c)}else if(a==="timesheet"){const c=await U(n);r.push(c)}else{const c=await U(n);!c.success&&c.errors.length>0&&c.errors.unshift("Could not detect CSV type. Expected LiquidPlanner timesheet or Microsoft Forms feedback export."),r.push(c)}}return r}function Kt(s){return"type"in s&&s.type==="feedback"}function Ut(){const[s,e]=I.useState(!1),[r,t]=I.useState(!1),[n,a]=I.useState(null),[c,d]=I.useState([]),p=I.useRef(null),l=async i=>{if(!i||i.length===0)return;const m=Array.from(i).filter(f=>f.name.endsWith(".csv"));if(m.length===0){alert("Please select CSV files only");return}t(!0),d([]);try{const f=await Gt(m,(D,E,O)=>{a({current:D,total:E,filename:O})});d(f),window.dispatchEvent(new CustomEvent("data-imported"))}catch(f){console.error("Import error:",f),alert("Import failed: "+(f instanceof Error?f.message:String(f)))}finally{t(!1),a(null)}},u=i=>{i.preventDefault(),i.stopPropagation(),e(!0)},w=i=>{i.preventDefault(),i.stopPropagation(),e(!1)},x=i=>{i.preventDefault(),i.stopPropagation()},v=i=>{i.preventDefault(),i.stopPropagation(),e(!1),l(i.dataTransfer.files)},j=i=>{l(i.target.files)},T=()=>{p.current?.click()};return o.jsxs("div",{className:"space-y-6",children:[o.jsxs("div",{className:`
          border-2 border-dashed rounded-lg p-10 text-center transition-colors cursor-pointer
          ${s?"border-[var(--accent)] bg-[var(--accent-light)]/20":"border-[var(--border-input)] hover:border-[var(--accent)] hover:bg-[var(--accent-light)]/10"}
          ${r?"opacity-50 pointer-events-none":""}
        `,onDragEnter:u,onDragLeave:w,onDragOver:x,onDrop:v,onClick:T,children:[o.jsx("input",{ref:p,type:"file",accept:".csv",multiple:!0,onChange:j,className:"hidden"}),o.jsx("svg",{className:"mx-auto w-10 h-10 text-[var(--text-muted)] mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),o.jsxs("p",{className:"text-[13px] font-medium text-[var(--text-secondary)]",children:["Drop CSV files here, or ",o.jsx("span",{className:"text-[var(--accent)] underline",children:"browse"})]}),o.jsx("p",{className:"text-[11px] text-[var(--text-muted)] mt-1",children:"Accepts LiquidPlanner timesheet exports and Microsoft Forms feedback exports (.csv)"})]}),r&&n&&o.jsx("div",{className:"border rounded-lg p-4 bg-[var(--accent-light)] border-[var(--accent)]",children:o.jsxs("div",{className:"flex items-center",children:[o.jsx("div",{className:"animate-spin mr-3",children:o.jsxs("svg",{className:"w-4 h-4 text-[var(--accent)]",fill:"none",viewBox:"0 0 24 24",children:[o.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),o.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("p",{className:"font-medium text-[13px] text-[var(--accent)]",children:["Importing ",n.current," of ",n.total,"..."]}),o.jsx("p",{className:"text-[11px] text-[var(--text-secondary)]",children:n.filename})]})]})}),c.length>0&&o.jsxs("div",{className:"bg-[var(--bg-panel)] border border-[var(--border-default)] rounded-lg overflow-hidden",children:[o.jsx("div",{className:"px-4 py-2.5 border-b border-[var(--border-subtle)] bg-[var(--bg-table-header)]",children:o.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-[var(--text-muted)]",children:"Import Results"})}),o.jsx("div",{className:"p-4 space-y-3",children:c.map((i,m)=>{const f=Kt(i);return o.jsx("div",{className:"border rounded-lg p-4",style:{backgroundColor:i.success?"var(--status-good-bg)":"var(--status-danger-bg)",borderColor:i.success?"var(--status-good-border)":"var(--status-danger-border)"},children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"flex-shrink-0 mt-0.5",children:i.success?o.jsx("svg",{className:"w-4 h-4 text-[var(--status-good)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):o.jsx("svg",{className:"w-4 h-4 text-[var(--status-danger)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:o.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("p",{className:"font-medium text-[13px] truncate text-[var(--text-primary)]",children:i.filename}),f&&o.jsx("span",{className:"flex-shrink-0 px-1.5 py-0.5 text-[10px] font-medium rounded bg-[var(--accent)] text-white",children:"Feedback"})]}),i.success&&f&&o.jsxs("div",{className:"mt-2 text-[11px] space-y-0.5 text-[var(--text-secondary)]",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Type:"})," Weekly Feedback Form"]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Week Ending:"})," ",i.weekEnding]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Records:"})," ",i.imported," new, ",i.updated," updated"]}),i.projects.length>0&&o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Projects:"})," ",i.projects.join(", ")]}),i.warnings.length>0&&o.jsxs("div",{className:"mt-1",children:[o.jsx("p",{className:"text-[11px] font-medium text-[var(--status-warn)]",children:"Warnings:"}),o.jsxs("ul",{className:"list-disc list-inside text-[11px] mt-0.5 text-[var(--status-warn)]",children:[i.warnings.slice(0,5).map((D,E)=>o.jsx("li",{children:D},E)),i.warnings.length>5&&o.jsxs("li",{children:["... and ",i.warnings.length-5," more"]})]})]})]}),i.success&&!f&&o.jsxs("div",{className:"mt-2 text-[11px] space-y-0.5 text-[var(--text-secondary)]",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Team:"})," ",i.team]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Date Range:"})," ",i.dateRangeStart," to ",i.dateRangeEnd]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Rows:"})," ",i.newRowsInserted.toLocaleString()," new,"," ",i.duplicateRowsSkipped.toLocaleString()," duplicate"," ","(",i.totalRowsParsed.toLocaleString()," total)"]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"Hours:"})," ",i.totalHoursImported.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),i.newPeopleDiscovered.length>0&&o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"New People:"})," ",i.newPeopleDiscovered.join(", ")]}),i.newProjectsDiscovered.length>0&&o.jsxs("p",{children:[o.jsx("span",{className:"font-medium",children:"New Projects:"})," ",i.newProjectsDiscovered.join(", ")]})]}),i.errors.length>0&&o.jsxs("div",{className:"mt-2",children:[o.jsx("p",{className:"text-[11px] font-medium text-[var(--status-danger)]",children:"Errors:"}),o.jsxs("ul",{className:"list-disc list-inside text-[11px] mt-1 text-[var(--status-danger)]",children:[i.errors.slice(0,5).map((D,E)=>o.jsx("li",{children:D},E)),i.errors.length>5&&o.jsxs("li",{children:["... and ",i.errors.length-5," more"]})]})]})]})]})},m)})})]})]})}function Xt(){const[s,e]=I.useState(null),[r,t]=I.useState(!0),n=async()=>{t(!0);try{const l=await qe();e(l)}catch(l){console.error("Failed to load dashboard stats:",l)}finally{t(!1)}};if(I.useEffect(()=>{n();const l=()=>{n()};return window.addEventListener("data-imported",l),()=>window.removeEventListener("data-imported",l)},[]),r)return o.jsxs("div",{className:"bg-[var(--bg-panel)] border border-[var(--border-default)] rounded-lg overflow-hidden",children:[o.jsx("div",{className:"px-4 py-2.5 border-b border-[var(--border-subtle)] bg-[var(--bg-table-header)]",children:o.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-[var(--text-muted)]",children:"Data Status"})}),o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"animate-pulse space-y-2",children:[o.jsx("div",{className:"h-3 bg-[var(--border-subtle)] rounded w-1/2"}),o.jsx("div",{className:"h-3 bg-[var(--border-subtle)] rounded w-3/4"})]})})]});if(!s||s.totalEntries===0)return o.jsxs("div",{className:"bg-[var(--bg-panel)] border border-[var(--border-default)] rounded-lg overflow-hidden",children:[o.jsx("div",{className:"px-4 py-2.5 border-b border-[var(--border-subtle)] bg-[var(--bg-table-header)]",children:o.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-[var(--text-muted)]",children:"Data Status"})}),o.jsx("div",{className:"p-4",children:o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("svg",{className:"w-4 h-4 text-[var(--status-warn)]",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-[13px] text-[var(--status-warn)]",children:"No data imported yet"}),o.jsx("p",{className:"text-[11px] text-[var(--text-muted)]",children:"Import a CSV file to get started"})]})]})})]});const a=l=>{try{return L(new Date(l),"MMM d, yyyy")}catch{return l}},c=l=>{try{return L(new Date(l),"MMM d, yyyy 'at' h:mm a")}catch{return l}},d=l=>{try{const[u,w]=l.split("/").map(Number);return L(new Date(u,w-1,1),"MMM yyyy")}catch{return l}},p=l=>l.from===l.to?d(l.from):`${d(l.from)} – ${d(l.to)}`;return o.jsxs("div",{className:"bg-[var(--bg-panel)] border border-[var(--border-default)] rounded-lg overflow-hidden",children:[o.jsxs("div",{className:"px-4 py-2.5 border-b border-[var(--border-subtle)] bg-[var(--bg-table-header)] flex items-center justify-between",children:[o.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-[var(--text-muted)]",children:"Data Status"}),o.jsxs("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-[11px] font-medium bg-[var(--status-good-bg)] text-[var(--status-good)]",children:[o.jsx("span",{className:"w-1.5 h-1.5 rounded-full mr-1 bg-[var(--status-good)]"}),"Active"]})]}),o.jsxs("div",{className:"p-4 grid grid-cols-1 sm:grid-cols-2 gap-3 text-[11px]",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-[var(--text-muted)]",children:"Last Import"}),o.jsx("p",{className:"font-medium mt-0.5 text-[var(--text-primary)]",children:s.lastImportDate?c(s.lastImportDate):"Never"})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[var(--text-muted)]",children:"Data Range"}),o.jsx("p",{className:"font-medium mt-0.5 text-[var(--text-primary)]",children:s.dateRangeStart&&s.dateRangeEnd?`${a(s.dateRangeStart)} – ${a(s.dateRangeEnd)}`:"No data"}),s.missingDateGaps.length>0&&o.jsxs("div",{className:"mt-1.5 flex items-start gap-1.5",children:[o.jsx("svg",{className:"w-3.5 h-3.5 text-[var(--status-warn)] flex-shrink-0 mt-0.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",viewBox:"0 0 24 24",stroke:"currentColor",children:o.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),o.jsxs("div",{children:[o.jsx("p",{className:"font-medium text-[var(--status-warn)]",children:"Missing data detected"}),s.missingDateGaps.map((l,u)=>o.jsx("p",{className:"text-[var(--text-muted)]",children:p(l)},u))]})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[var(--text-muted)]",children:"Total Hours"}),o.jsxs("p",{className:"font-medium mt-0.5 tabular-nums text-[var(--text-primary)]",children:[s.totalHours.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ",o.jsxs("span",{className:"font-normal text-[var(--text-muted)]",children:["across ",s.totalEntries.toLocaleString()," entries"]})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-[var(--text-muted)]",children:"Team Members"}),o.jsxs("p",{className:"font-medium mt-0.5 text-[var(--text-primary)]",children:[s.peopleCount," total"," ",o.jsxs("span",{className:"font-normal text-[var(--text-muted)]",children:["(",s.engineerCount," eng, ",s.techCount," lab",s.unclassifiedCount>0&&`, ${s.unclassifiedCount} other`,")"]})]})]})]})]})}function nr(){return o.jsxs("div",{className:"max-w-2xl mx-auto",children:[o.jsx("h1",{className:"text-lg font-bold text-[var(--text-primary)] mb-1",children:"Import Data"}),o.jsx("p",{className:"text-[13px] text-[var(--text-muted)] mb-6",children:"Upload LiquidPlanner timesheet exports or Microsoft Forms feedback exports."}),o.jsx(Ut,{}),o.jsx("div",{className:"mt-6",children:o.jsx(Xt,{})})]})}export{nr as ImportPage};
