import{g as W,d as k,P as F,j as e,a as M}from"./index-CmBIJSzo.js";import{r as m}from"./vendor-B7kh90xw.js";import{u as T}from"./data-BuiUnMz4.js";import{u as E,v as $,x as V}from"./weekDates-DBDw0wls.js";async function B(a,d){const h=W(a),{start:b,end:j}=E(d),p=(await k.timesheets.where("date").between(b,j,!0,!0).toArray()).filter(t=>t.r_number===a||W(t.r_number)===h),f=await k.teamMembers.toArray(),i=new Map(f.map(t=>[t.full_name,t.role])),s=new Map;let c=0,l=0;const v=new Set,g=new Set;for(const t of p){i.get(t.full_name)===F.Engineer?c+=t.hours:l+=t.hours,v.add(t.full_name),g.add(t.activity);const _=s.get(t.task_id);_?(_.hours+=t.hours,_.contributors.add(t.full_name),t.is_done&&(_.is_done=!0)):s.set(t.task_id,{task_name:t.task||`Task ${t.task_id}`,task_id:t.task_id,hours:t.hours,is_done:t.is_done,activity:t.activity,contributors:new Set([t.full_name])})}const n=[...s.values()].map(t=>({task_name:t.task_name,task_id:t.task_id,hours:Math.round(t.hours*10)/10,is_done:t.is_done,activity:t.activity,contributors:[...t.contributors].sort()})).sort((t,x)=>x.hours-t.hours);return{total_hours:Math.round((c+l)*10)/10,engineer_hours:Math.round(c*10)/10,lab_hours:Math.round(l*10)/10,contributors:[...v].sort(),tasks:n,tasks_completed:n.filter(t=>t.is_done).map(t=>t.task_name),activities:[...g].sort()}}function Y(a){return a.tasks.length===0?"No activity recorded":a.tasks.map(d=>`${d.is_done?"✓":"○"} ${d.task_name} (${d.hours}h)`).join(`
`)}function D(a){const d=T(async()=>a?k.weeklyUpdates.where("week_ending").equals(a).toArray():[],[a]);return{updates:d??[],saveUpdate:async u=>{const p=new Date().toISOString(),f=await k.weeklyUpdates.where("[project_id+week_ending]").equals([u.project_id,u.week_ending]).first();f?await k.weeklyUpdates.update(f.id,{...u,updated_at:p}):await k.weeklyUpdates.add({...u,updated_at:p})},getPreviousWeekUpdate:async(u,p)=>(await k.weeklyUpdates.where("project_id").equals(u).toArray()).filter(i=>i.week_ending<p).sort((i,s)=>s.week_ending.localeCompare(i.week_ending))[0],getUpdate:async(u,p)=>k.weeklyUpdates.where("[project_id+week_ending]").equals([u,p]).first(),loading:d===void 0}}function G({availableWeeks:a,selectedWeek:d,onWeekChange:h,onMeetingPrep:b}){return e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h1",{className:"text-lg font-bold text-[var(--text-primary)]",children:"Weekly Updates"}),e.jsx("select",{value:d,onChange:j=>h(j.target.value),className:"text-[13px] px-3 py-1.5 border border-[var(--border-input)] rounded-md bg-[var(--bg-input)] text-[var(--text-primary)] focus:ring-2 focus:ring-[var(--accent-focus-ring)] focus:outline-none",children:a.map(j=>e.jsxs("option",{value:j,children:["Week ending ",j]},j))}),d&&e.jsx("span",{className:"text-[13px] text-[var(--text-muted)]",children:$(d)})]}),e.jsx("button",{onClick:b,className:"text-[13px] font-medium px-4 py-2 rounded-md bg-[var(--accent)] text-white hover:bg-[var(--accent-hover)] transition-colors",children:"Meeting Prep"})]})}const K={"on-track":{bg:"var(--status-good-bg)",text:"var(--status-good)",border:"var(--status-good)",label:"On Track"},"at-risk":{bg:"var(--status-warn-bg)",text:"var(--status-warn)",border:"var(--status-warn)",label:"At Risk"},blocked:{bg:"var(--status-danger-bg)",text:"var(--status-danger)",border:"var(--status-danger)",label:"Blocked"},complete:{bg:"var(--accent-light)",text:"var(--accent)",border:"var(--accent)",label:"Complete"}};function Q({projectId:a,projectName:d,autoSummary:h,update:b,onClick:j}){const u=b?.status,p=u?K[u]:null,f=h?.total_hours??0,i=h?.tasks.length??0,s=h?.tasks_completed.length??0,c=b?.action_items.length??0,l=b?.action_items.filter(g=>g.done).length??0,v=h&&h.tasks.length>0?h.tasks.slice(0,3).map(g=>`${g.is_done?"✓":"○"} ${g.task_name} (${g.hours}h)`).join("  "):"No activity recorded";return e.jsx("button",{onClick:j,className:"w-full text-left rounded-lg border-l-[3px] border border-[var(--border-default)] bg-[var(--bg-panel)] px-4 py-3 hover:shadow-sm transition-shadow cursor-pointer",style:{borderLeftColor:p?.border??"var(--border-subtle)"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-[13px] font-bold text-[var(--text-primary)]",children:a}),e.jsx("span",{className:"text-[13px] text-[var(--text-secondary)] truncate",children:d})]}),e.jsx("p",{className:"text-[12px] text-[var(--text-muted)] truncate",children:v})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"text-[11px] font-medium text-[var(--text-muted)] bg-[var(--bg-table-header)] px-2 py-0.5 rounded",children:[f,"h"]}),i>0&&e.jsxs("span",{className:"text-[11px] text-[var(--text-muted)] bg-[var(--bg-table-header)] px-2 py-0.5 rounded",children:[s,"/",i," tasks"]}),c>0&&e.jsxs("span",{className:"text-[11px] text-[var(--text-muted)] bg-[var(--bg-table-header)] px-2 py-0.5 rounded",children:[l,"/",c," items"]}),p&&e.jsx("span",{className:"text-[11px] font-semibold px-2 py-0.5 rounded",style:{backgroundColor:p.bg,color:p.text},children:p.label}),!b&&e.jsx("span",{className:"text-[11px] italic text-[var(--text-muted)]",children:"No update"})]})]})})}const J=[{value:"on-track",label:"On Track",color:"var(--status-good)",bg:"var(--status-good-bg)"},{value:"at-risk",label:"At Risk",color:"var(--status-warn)",bg:"var(--status-warn-bg)"},{value:"blocked",label:"Blocked",color:"var(--status-danger)",bg:"var(--status-danger-bg)"},{value:"complete",label:"Complete",color:"var(--accent)",bg:"var(--accent-light)"}];function X({projectId:a,weekEnding:d,onClose:h}){const{saveUpdate:b,getUpdate:j,getPreviousWeekUpdate:u}=D(),p=T(()=>k.teamMembers.toArray())??[],f=T(()=>k.projects.get(a)),[i,s]=m.useState("on-track"),[c,l]=m.useState([]),[v,g]=m.useState(""),[n,o]=m.useState(""),[t,x]=m.useState(null),[_,O]=m.useState(!1),[I,N]=m.useState(!1);m.useEffect(()=>{let r=!1;async function w(){const y=await B(a,d);if(r)return;x(y);const S=await j(a,d);if(!r){if(S)s(S.status),l(S.action_items),g(S.next_milestones),o(S.notes);else{const U=await u(a,d);if(r)return;if(U){const z=U.action_items.filter(H=>!H.done).map(H=>({...H,done:!1,carried_from:H.carried_from??U.week_ending}));l(z),s(U.status==="complete"?"on-track":U.status)}}O(!0)}}return w(),()=>{r=!0}},[a,d]);const A=async()=>{N(!0);try{await b({project_id:a,week_ending:d,status:i,completed_summary:t?Y(t):"",action_items:c,next_milestones:v,notes:n,updated_by:""}),h()}finally{N(!1)}},C=()=>{l([...c,{id:crypto.randomUUID(),text:"",owner:"",due_date:"",done:!1}])},P=(r,w)=>{l(y=>y.map((S,U)=>U===r?{...S,...w}:S))},q=r=>{l(w=>w.filter((y,S)=>S!==r))};return _?e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center bg-black/30 overflow-y-auto py-8",children:e.jsxs("div",{className:"bg-[var(--bg-panel)] rounded-xl shadow-lg w-full max-w-2xl mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[var(--border-default)]",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-[15px] font-bold text-[var(--text-primary)]",children:[a," — ",f?.project_name??a]}),e.jsx("p",{className:"text-[12px] text-[var(--text-muted)]",children:$(d)})]}),e.jsx("button",{onClick:h,className:"text-[var(--text-muted)] hover:text-[var(--text-primary)] text-lg",children:"✕"})]}),e.jsxs("div",{className:"px-6 py-5 space-y-6 max-h-[calc(100vh-200px)] overflow-y-auto",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:"Completed This Week"}),e.jsx("div",{className:"rounded-lg bg-[var(--bg-table-header)] border border-[var(--border-subtle)] p-3",children:t&&t.tasks.length>0?e.jsxs("div",{className:"space-y-1",children:[t.tasks.map((r,w)=>e.jsxs("div",{className:"flex items-center gap-2 text-[13px]",children:[e.jsx("span",{className:r.is_done?"text-[var(--status-good)]":"text-[var(--text-muted)]",children:r.is_done?"✓":"○"}),e.jsx("span",{className:`flex-1 ${r.is_done?"text-[var(--text-secondary)]":"text-[var(--text-primary)]"}`,children:r.task_name}),e.jsxs("span",{className:"text-[12px] text-[var(--text-muted)] tabular-nums",children:[r.hours,"h"]}),e.jsxs("span",{className:"text-[11px] text-[var(--text-muted)]",children:["(",r.contributors.join(", "),")"]})]},w)),e.jsxs("div",{className:"border-t border-[var(--border-subtle)] mt-2 pt-2 flex gap-4 text-[12px] text-[var(--text-muted)]",children:[e.jsxs("span",{children:["Total: ",t.total_hours,"h"]}),e.jsxs("span",{children:["Eng: ",t.engineer_hours,"h"]}),e.jsxs("span",{children:["Lab: ",t.lab_hours,"h"]})]})]}):e.jsx("p",{className:"text-[13px] text-[var(--text-muted)] italic",children:"No activity recorded this week"})})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:"Status"}),e.jsx("div",{className:"flex gap-2",children:J.map(r=>e.jsx("button",{onClick:()=>s(r.value),className:"text-[12px] font-semibold px-4 py-2 rounded-md border transition-colors",style:{backgroundColor:i===r.value?r.bg:"transparent",borderColor:i===r.value?r.color:"var(--border-input)",color:i===r.value?r.color:"var(--text-secondary)"},children:r.label},r.value))})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:"Action Items"}),e.jsxs("div",{className:"space-y-2",children:[c.map((r,w)=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.done,onChange:y=>P(w,{done:y.target.checked}),className:"mt-2 w-4 h-4 rounded border-[var(--border-input)] text-[var(--accent)] focus:ring-[var(--accent-focus-ring)]"}),e.jsxs("div",{className:"flex-1 space-y-1",children:[e.jsx("input",{type:"text",value:r.text,onChange:y=>P(w,{text:y.target.value}),placeholder:"Action item...",className:`w-full text-[13px] px-2 py-1.5 border border-[var(--border-input)] rounded bg-[var(--bg-input)] text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-focus-ring)] ${r.done?"line-through opacity-60":""}`}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:r.owner,onChange:y=>P(w,{owner:y.target.value}),className:"text-[11px] px-2 py-1 border border-[var(--border-input)] rounded bg-[var(--bg-input)] text-[var(--text-secondary)] focus:outline-none focus:ring-1 focus:ring-[var(--accent-focus-ring)]",children:[e.jsx("option",{value:"",children:"Owner..."}),p.map(y=>e.jsx("option",{value:y.full_name,children:y.full_name},y.person_id))]}),e.jsx("input",{type:"date",value:r.due_date,onChange:y=>P(w,{due_date:y.target.value}),className:"text-[11px] px-2 py-1 border border-[var(--border-input)] rounded bg-[var(--bg-input)] text-[var(--text-secondary)] focus:outline-none focus:ring-1 focus:ring-[var(--accent-focus-ring)]"}),r.carried_from&&e.jsxs("span",{className:"text-[10px] text-[var(--text-muted)] italic self-center",children:["carried from ",r.carried_from]})]})]}),e.jsx("button",{onClick:()=>q(w),className:"mt-1.5 text-[12px] text-red-400 hover:text-red-600",children:"✕"})]},r.id)),e.jsx("button",{onClick:C,className:"text-[12px] text-[var(--accent)] hover:text-[var(--accent-hover)] font-medium",children:"+ Add action item"})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:"Next Milestones"}),e.jsx("textarea",{value:v,onChange:r=>g(r.target.value),placeholder:"Key milestones coming up...",rows:2,className:"w-full text-[13px] px-3 py-2 border border-[var(--border-input)] rounded-md bg-[var(--bg-input)] text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-focus-ring)] resize-none"})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:"Notes"}),e.jsx("textarea",{value:n,onChange:r=>o(r.target.value),placeholder:"Additional notes, context, blockers...",rows:3,className:"w-full text-[13px] px-3 py-2 border border-[var(--border-input)] rounded-md bg-[var(--bg-input)] text-[var(--text-primary)] focus:outline-none focus:ring-2 focus:ring-[var(--accent-focus-ring)] resize-none"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-[var(--border-default)]",children:[e.jsx("button",{onClick:h,className:"text-[13px] font-medium px-4 py-2 rounded-md border border-[var(--border-input)] text-[var(--text-secondary)] bg-white hover:bg-[var(--bg-table-header)] transition-colors",children:"Cancel"}),e.jsx("button",{onClick:A,disabled:I,className:"text-[13px] font-medium px-5 py-2 rounded-md bg-[var(--accent)] text-white hover:bg-[var(--accent-hover)] transition-colors disabled:opacity-50",children:I?"Saving...":"Save Update"})]})]})}):e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30",children:e.jsx("div",{className:"bg-[var(--bg-panel)] rounded-xl shadow-lg p-8 w-full max-w-2xl",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-[var(--border-subtle)] rounded w-1/3"}),e.jsx("div",{className:"h-20 bg-[var(--border-subtle)] rounded"}),e.jsx("div",{className:"h-8 bg-[var(--border-subtle)] rounded w-2/3"})]})})})}const L=[M.NPD,M.Sustaining,M.Sprint],Z={"on-track":{label:"On Track",color:"var(--status-good)"},"at-risk":{label:"At Risk",color:"var(--status-warn)"},blocked:{label:"Blocked",color:"var(--status-danger)"},complete:{label:"Complete",color:"var(--accent)"}};function ee({weekEnding:a,weekProjects:d,autoSummaries:h,updates:b,onClose:j}){const u=m.useMemo(()=>{const s=new Map;for(const c of b)s.set(c.project_id,c);return s},[b]),p=m.useMemo(()=>{const s=new Map;for(const c of L)s.set(c,[]);for(const c of d){const l=s.get(c.type);l&&l.push(c)}return s},[d]),f=m.useMemo(()=>d.filter(s=>s.type===M.Admin||s.type===M.OutOfOffice?!1:!u.has(s.project_id)&&s.totalHours>0),[d,u]),i=m.useMemo(()=>{const s=[];for(const c of b)for(const l of c.action_items)!l.done&&l.due_date&&l.due_date<a&&s.push({projectId:c.project_id,item:l});return s},[b,a]);return e.jsxs("div",{className:"fixed inset-0 z-50 bg-[var(--bg-page)] overflow-y-auto print:static print:overflow-visible",children:[e.jsxs("div",{className:"flex items-center justify-between px-8 py-5 border-b border-[var(--border-default)] bg-[var(--bg-panel)] print:border-0",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-[18px] font-bold text-[var(--text-primary)]",children:"Meeting Prep"}),e.jsx("p",{className:"text-[13px] text-[var(--text-muted)]",children:$(a)})]}),e.jsxs("div",{className:"flex gap-3 print:hidden",children:[e.jsx("button",{onClick:()=>window.print(),className:"text-[13px] font-medium px-4 py-2 rounded-md border border-[var(--border-input)] text-[var(--text-secondary)] bg-white hover:bg-[var(--bg-table-header)] transition-colors",children:"Print"}),e.jsx("button",{onClick:j,className:"text-[13px] font-medium px-4 py-2 rounded-md bg-[var(--accent)] text-white hover:bg-[var(--accent-hover)] transition-colors",children:"Close"})]})]}),e.jsxs("div",{className:"max-w-4xl mx-auto px-8 py-6 space-y-8",children:[(f.length>0||i.length>0)&&e.jsxs("div",{className:"space-y-3",children:[f.length>0&&e.jsxs("div",{className:"rounded-lg border border-[var(--status-warn)] bg-[var(--status-warn-bg)] p-4",children:[e.jsxs("h3",{className:"text-[13px] font-semibold text-[var(--status-warn)] mb-1",children:["Missing Updates (",f.length,")"]}),e.jsx("p",{className:"text-[12px] text-[var(--text-secondary)]",children:f.map(s=>s.project_id).join(", ")})]}),i.length>0&&e.jsxs("div",{className:"rounded-lg border border-[var(--status-danger)] bg-[var(--status-danger-bg)] p-4",children:[e.jsxs("h3",{className:"text-[13px] font-semibold text-[var(--status-danger)] mb-1",children:["Overdue Action Items (",i.length,")"]}),e.jsx("div",{className:"space-y-1",children:i.map((s,c)=>e.jsxs("p",{className:"text-[12px] text-[var(--text-secondary)]",children:[e.jsx("span",{className:"font-medium",children:s.projectId}),": ",s.item.text,s.item.owner&&e.jsxs("span",{className:"text-[var(--text-muted)]",children:[" (",s.item.owner,")"]}),e.jsxs("span",{className:"text-[var(--status-danger)] ml-1",children:["due ",s.item.due_date]})]},c))})]})]}),L.map(s=>{const c=p.get(s)??[];return c.length===0?null:e.jsxs("section",{children:[e.jsx("h2",{className:"text-[14px] font-bold uppercase tracking-wider text-[var(--text-primary)] mb-3 border-b border-[var(--border-default)] pb-1",children:s}),e.jsx("div",{className:"space-y-4",children:c.map(l=>{const v=u.get(l.project_id),g=h.get(l.project_id),n=v?Z[v.status]:null;return e.jsxs("div",{className:"rounded-lg border border-[var(--border-default)] bg-[var(--bg-panel)] p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-[14px] font-bold text-[var(--text-primary)]",children:l.project_id}),e.jsx("span",{className:"text-[13px] text-[var(--text-secondary)]",children:l.project_name}),n&&e.jsx("span",{className:"text-[11px] font-semibold px-2 py-0.5 rounded ml-auto",style:{color:n.color,border:`1px solid ${n.color}`},children:n.label}),e.jsxs("span",{className:"text-[12px] text-[var(--text-muted)] tabular-nums",children:[l.totalHours,"h"]})]}),g&&g.tasks.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-[11px] font-semibold text-[var(--text-muted)] uppercase mb-1",children:"Completed"}),e.jsx("div",{className:"space-y-0.5",children:g.tasks.map((o,t)=>e.jsxs("div",{className:"text-[12px] flex items-center gap-2",children:[e.jsx("span",{className:o.is_done?"text-[var(--status-good)]":"text-[var(--text-muted)]",children:o.is_done?"✓":"○"}),e.jsx("span",{className:"text-[var(--text-primary)]",children:o.task_name}),e.jsxs("span",{className:"text-[var(--text-muted)] tabular-nums",children:[o.hours,"h"]})]},t))})]}),v&&v.action_items.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-[11px] font-semibold text-[var(--text-muted)] uppercase mb-1",children:"Action Items"}),e.jsx("div",{className:"space-y-0.5",children:v.action_items.map((o,t)=>{const x=!o.done&&o.due_date&&o.due_date<a;return e.jsxs("div",{className:"text-[12px] flex items-center gap-2",children:[e.jsx("span",{className:o.done?"text-[var(--status-good)]":x?"text-[var(--status-danger)]":"text-[var(--text-muted)]",children:o.done?"✓":"○"}),e.jsx("span",{className:`${o.done?"line-through opacity-60":""} ${x?"text-[var(--status-danger)]":"text-[var(--text-primary)]"}`,children:o.text}),o.owner&&e.jsxs("span",{className:"text-[var(--text-muted)]",children:["(",o.owner,")"]}),x&&e.jsx("span",{className:"text-[10px] font-semibold text-[var(--status-danger)] bg-[var(--status-danger-bg)] px-1.5 py-0.5 rounded",children:"OVERDUE"})]},t)})})]}),v?.next_milestones&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h4",{className:"text-[11px] font-semibold text-[var(--text-muted)] uppercase mb-1",children:"Next Milestones"}),e.jsx("p",{className:"text-[12px] text-[var(--text-primary)] whitespace-pre-wrap",children:v.next_milestones})]}),v?.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-[11px] font-semibold text-[var(--text-muted)] uppercase mb-1",children:"Notes"}),e.jsx("p",{className:"text-[12px] text-[var(--text-secondary)] whitespace-pre-wrap",children:v.notes})]}),!v&&e.jsx("p",{className:"text-[12px] italic text-[var(--text-muted)]",children:"No update submitted"})]},l.project_id)})})]},s)})]})]})}const R=[M.NPD,M.Sustaining,M.Sprint];function ne(){const[a,d]=m.useState(""),[h,b]=m.useState(null),[j,u]=m.useState(!1),[p,f]=m.useState(new Map),i=T(async()=>{const n=await k.timesheets.orderBy("date").uniqueKeys();return V(n.map(o=>({date:o})))})??[];m.useEffect(()=>{i.length>0&&!a&&d(i[0])},[i,a]);const s=T(async()=>{if(!a)return[];const{start:n,end:o}=E(a),t=await k.timesheets.where("date").between(n,o,!0,!0).toArray(),x=await k.projects.toArray(),_=new Map(x.map(N=>[N.project_id,N])),O=new Map;for(const N of t){const A=W(N.r_number),C=O.get(A)??{hours:0,rNumbers:new Set};C.hours+=N.hours,C.rNumbers.add(N.r_number),O.set(A,C)}const I=[];for(const[N,A]of O){const C=_.get(N)??[...A.rNumbers].map(P=>_.get(P)).find(Boolean);I.push({project_id:N,project_name:C?.project_name??N,type:C?.type??M.Admin,totalHours:Math.round(A.hours*10)/10})}return I.sort((N,A)=>A.totalHours-N.totalHours)},[a])??[],{updates:c}=D(a),l=m.useMemo(()=>{const n=new Map;for(const o of c)n.set(o.project_id,o);return n},[c]);m.useEffect(()=>{if(!a||s.length===0){f(new Map);return}let n=!1;async function o(){const t=new Map;for(const x of s){if(n)return;const _=await B(x.project_id,a);t.set(x.project_id,_)}n||f(t)}return o(),()=>{n=!0}},[a,s]);const v=m.useMemo(()=>{const n=new Map;for(const x of R)n.set(x,[]);const o=new Set(s.map(x=>x.project_id)),t=[...s];for(const x of c)o.has(x.project_id)||t.push({project_id:x.project_id,project_name:x.project_id,type:M.NPD,totalHours:0});for(const x of t){const _=n.get(x.type);_&&_.push(x)}return n},[s,c]),g=m.useMemo(()=>s.filter(n=>n.type===M.Admin||n.type===M.OutOfOffice),[s]);return i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("svg",{className:"w-12 h-12 text-[var(--text-muted)] mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),e.jsx("p",{className:"text-[14px] text-[var(--text-muted)]",children:"No timesheet data available. Import data to start tracking weekly updates."})]}):e.jsxs("div",{children:[e.jsx(G,{availableWeeks:i,selectedWeek:a,onWeekChange:d,onMeetingPrep:()=>u(!0)}),e.jsxs("div",{className:"space-y-6",children:[R.map(n=>{const o=v.get(n)??[];return o.length===0?null:e.jsxs("section",{children:[e.jsxs("h2",{className:"text-[12px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:[n," (",o.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:o.map(t=>e.jsx(Q,{projectId:t.project_id,projectName:t.project_name,autoSummary:p.get(t.project_id)??null,update:l.get(t.project_id),onClick:()=>b(t.project_id)},t.project_id))})]},n)}),g.length>0&&e.jsxs("section",{children:[e.jsxs("h2",{className:"text-[12px] font-semibold uppercase tracking-wider text-[var(--text-muted)] mb-2",children:["Admin / OOO (",g.length,")"]}),e.jsx("div",{className:"space-y-1.5",children:g.map(n=>e.jsxs("div",{className:"px-4 py-2 rounded-lg border border-[var(--border-subtle)] bg-[var(--bg-panel)] opacity-60",children:[e.jsx("span",{className:"text-[13px] font-medium text-[var(--text-muted)]",children:n.project_id}),e.jsxs("span",{className:"text-[12px] text-[var(--text-muted)] ml-2",children:[n.project_name," — ",n.totalHours,"h"]})]},n.project_id))})]})]}),h&&e.jsx(X,{projectId:h,weekEnding:a,onClose:()=>b(null)}),j&&e.jsx(ee,{weekEnding:a,weekProjects:s,autoSummaries:p,updates:c,onClose:()=>u(!1)})]})}export{ne as UpdatesPage};
